<!DOCTYPE html>
<html>
    <head>
        <title>发布作品</title>
        <link rel='stylesheet' href='/stylesheets/main.css' />
        <script src="/javascripts/postPage.js"></script>
        <script src="/javascriptLibraries/jquery-2.1.0.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                onReady();
            });
        </script>
    </head>
    <body>
        <% include header %>
        <div class="content">
            <p class="error"><%= message %></p>
            <% if(locals.item) { %>
                <form method="post" id="post" action="/editPost/<%= item.id%>" enctype="multipart/form-data">
                    <input type="text" name="subject" value="<%= item.subject %>" placeholder="作品名称"/>
                    <select name="category">
                        <% for(var i = 0; i < categories.length; i++) {%>
                        <option value="<%= categories[i].value.dbValue %>"
                                <% if(categories[i].value.dbValue === item.category) { %>
                                    selected="selected"
                                <% } %>>
                            <%= categories[i].value.label %>
                        </option>
                        <% } %>
                    </select><br>
                    <img src="<%= item.postImage%>"/>
                    <input type="file" name="pic" value="<%= item.pic %>" aria-label="主图"/><br>
                    <textarea name="summary" placeholder="简述" rows="4" cols="50"><%= item.summary %></textarea><br>
                    <div class="materials_section">
                        原料：<br>
                        <div class="materials_list" id="materials_list">
                            <% for(var i = 0; item.materials && i < item.materials.length; i++) {%>
                                <div class="material">
                                    <input type="text" name="materials_name_<%= i %>" value="<%= item.materials[i].name%>" placeholder="名称"/>
                                    <input type="text" name="materials_quantity_<%= i %>" value="<%= item.materials[i].quantity%>" placeholder="数量"/>
                                    <a href="javascript:void(0)" name="materials_cancel_<%= i %>">x</a>
                                </div>
                            <% } %>
                        </div>
                        <a href="javascript:void(0)" id="materials_add_action">
                            +添加材料
                        </a>
                    </div>
                    <div class="tools_section">
                        工具：<br>
                        <div class="tools_list" id="tools_list">
                            <% for(var i = 0; item.tools && i < item.tools.length; i++) {%>
                            <div class="tool">
                                <input type="text" name="tools_name_<%= i %>" value="<%= item.tools[i].name%>" placeholder="名称"/>
                                <input type="text" name="tools_quantity_<%= i %>" value="<%= item.tools[i].quantity%>" placeholder="数量"/>
                                <a href="javascript:void(0)" name="tools_cancel_<%= i %>">x</a>
                            </div>
                            <% } %>
                        </div>
                        <a href="javascript:void(0)" id="tools_add_action">
                            +添加工具
                        </a>
                    </div>
                    <div class="steps_section">
                        制作步骤：<br>
                        <div class="steps_list" id="steps_list">
                            <% for(var i = 0; item.steps && i < item.steps.length; i++) {%>
                            <div class="steps">
                                <input type="file" name="steps_image_"<%= i %> value="" aria-label="步骤图"/>
                                <textarea name="steps_summary_<%= i %>" placeholder="步骤简述" rows="4" cols="50" ></textarea>
                                <a href="javascript:void(0)" name="steps_cancel_<%= i %>" class="tools_cancel_action">x</a>
                            </div>
                            <% } %>
                        </div>
                        <a href="javascript:void(0)" id="steps_add_action">
                            +添加步骤
                        </a>
                    </div>

                    <input type="hidden" name="id" value="<%= item._id %>"/>
                    <button type="submit" name="update">发布</button><br>
                </form>
            <% } %>
        </div>
        <% include footer %>
    </body>
</html>